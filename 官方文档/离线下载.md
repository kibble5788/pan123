# 离线下载相关接口说明
## 一、创建离线下载任务接口
### （一）接口基础信息
- **API 地址**：POST 域名 + /api/v1/offline/download
- **核心说明**：仅支持创建 http/https 协议的离线下载任务，不支持其他协议链接。

### （二）请求参数
#### 1. Header 参数
| 名称 | 类型 | 是否必填 | 说明 |
| ---- | ---- | ---- | ---- |
| Authorization | string | 是 | 鉴权 access_token |
| Platform | string | 是 | 固定值：open_platform |

#### 2. Body 参数
| 名称 | 类型 | 是否必填 | 说明 |
| ---- | ---- | ---- | ---- |
| url | string | 是 | 下载资源地址（必须为 http/https 协议） |
| fileName | string | 否 | 自定义文件名称，需携带支持的图片格式（png、gif、jpeg、tiff、webp、jpg、tif、svg、bmp） |
| dirID | number | 否 | 指定下载目录 ID（示例：10023），不支持下载到根目录，默认下载至“来自:离线下载”目录 |
| callBackUrl | string | 否 | 回调地址，文件下载成功或失败时，会通过该地址通知 |

#### 3. 回调内容说明（callBackUrl 接收数据）
- 请求类型：POST
- 回调数据格式示例：
```json
{
"url": "http://dc.com/resource.jpg",
"status": 0,  // 0-成功，1-失败
"failReason": "",  // 失败时返回具体原因，成功时为空
"fileID": 100  // 成功时返回文件在云盘的唯一 ID
}
```

### （三）返回数据
| 名称 | 类型 | 是否必填 | 说明 |
| ---- | ---- | ---- | ---- |
| taskID | number | 是 | 离线下载任务 ID，用于查询下载进度 |

### （四）请求示例（Curl）
```curl
curl --location 'https://open-api.123pan.com/api/v1/offline/download' \
--header 'Content-Type: application/json' \
--header 'Platform: open_platform' \
--header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJl...(过长省略)' \
--data '{
"url": "https://vip.123pan.cn/1815309870/...(过长省略)",
"fileName": "测试https离线下载.mp4"
}'
```

### （五）补充说明
- 其他语言请求示例（Java - OkHttp、JavaScript - jQuery、NodeJs - Axios、Python - http.client）可参考官方完整文档。
- 若自定义 fileName 未携带支持的图片格式，或 url 协议不符合要求，接口会返回对应错误提示。

## 二、获取离线下载进度接口
### （一）接口基础信息
- **API 地址**：GET 域名 + /api/v1/offline/download/process
- **核心用途**：通过离线下载任务 ID，查询对应任务的下载进度和状态。

### （二）请求参数
#### 1. Header 参数
| 名称 | 类型 | 是否必填 | 说明 |
| ---- | ---- | ---- | ---- |
| Authorization | string | 是 | 鉴权 access_token |
| Platform | string | 是 | 固定值：open_platform |

#### 2. QueryString 参数
| 名称 | 类型 | 是否必填 | 说明 |
| ---- | ---- | ---- | ---- |
| taskID | number | 是 | 离线下载任务 ID（来源于“创建离线下载任务”接口的返回数据） |

### （三）返回数据
| 名称 | 类型 | 是否必填 | 说明 |
| ---- | ---- | ---- | ---- |
| process | float | 是 | 下载进度百分比，下载失败时进度会归零 |
| status | int | 是 | 下载状态：0-进行中、1-下载失败、2-下载成功、3-重试中 |

### （四）请求示例（参考格式）
#### Curl 示例（模板）
```curl
curl --location 'https://open-api.123pan.com/api/v1/offline/download/process?taskID=100001' \
--header 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5c...(过长省略)' \
--header 'Platform: open_platform'
```

#### 其他语言示例
支持 Java - OkHttp、JavaScript - jQuery、NodeJs - Axios、Python - http.client 等语言，具体实现可参考官方完整文档。

### （五）响应示例（参考格式）
```json
{
"code": 0,
"message": "ok",
"data": {
"process": 85.5,
"status": 0
},
"x-traceID": "98765432-10ab-cdef-ghij-klmnopqrstuv_kong-db-5898fdd8c6-t5pvc"
}
```

### （六）补充说明
- 响应中 `code: 0` 表示接口请求成功，可通过 `status` 字段判断任务状态，`process` 字段查看实时进度。
- 若 `taskID` 不存在或无查询权限，接口会返回对应错误提示，具体信息可查看 `message` 字段。
- 建议根据任务状态合理设置查询频率：进行中（status=0）或重试中（status=3）可间隔一段时间查询，成功（status=2）或失败（status=1）后无需重复查询。